tripalium.projets.work {
    # Backend API auth routes (login, signup, etc.)
    handle /api/auth/login {
        reverse_proxy api:3001
    }
    handle /api/auth/signup {
        reverse_proxy api:3001
    }
    handle /api/auth/api-keys* {
        reverse_proxy api:3001
    }

    # NextAuth routes (session, callback, etc.)
    handle /api/auth/* {
        reverse_proxy web:3000
    }

    # Backend API routes
    handle /api/* {
        reverse_proxy api:3001
    }

    # Next.js app
    handle {
        reverse_proxy web:3000
    }

    # Enable compression
    encode gzip

    # Security headers
    header {
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    # Logging
    log {
        output file /var/log/caddy/access.log
    }
}
